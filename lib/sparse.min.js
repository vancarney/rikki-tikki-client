// Generated by CoffeeScript 1.6.2
var Backbone,global,_,__hasProp={}.hasOwnProperty,__extends=function(e,t){function i(){this.constructor=e}var n="prototype";for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);return i[n]=t[n],e[n]=new i,e.__super__=t[n],e};global=typeof exports!="undefined"&&exports!==null?exports:window,typeof exports!="undefined"&&(_=require("underscore")._,Backbone=require("backbone")),function(){"use strict";var e="prototype",t="className",n="success",r="__super__",i="objectId",s="sparse.Collection requires className to be defined",o="constructor",u=null,a="Collection",f="__action",l="API_URI",c="UNDEFINED_CLASSNAME",h="undefined",p="destroy",d="__processed",v="extend",m="operate",g="DEFAULT_FETCH_LIMIT_OVERRIDE",y="_memberIsNew",b="models",w="login",E="/classes/",S="SESSION_TOKEN",x="call",T="stringify",N="MAX_BATCH_SIZE",C="application/json",k="urlMap",L="length",A="isNew",O="__method",M="__params",D="/users",P="toJSON",H="getConstructorName",B="sync",j="__to_remove",F="$1es",I="create",q="Model",R="clone",U="error",z=!1,W="replace",X="apiOPTS",V="sessionToken",$="hasOwnProperty",J="_prepareModel",K="complete",Q,G,Y;return global.sparse||(Q=global.sparse={VERSION:"0.2.1-alpha",APP_ID:void 0,REST_KEY:void 0,SESSION_TOKEN:void 0,API_VERSION:"1",MAX_BATCH_SIZE:50,DEFAULT_FETCH_LIMIT_OVERRIDE:2e5,UNDEFINED_CLASSNAME:"__UNDEFINED_CLASSNAME__",API_URI:"https://api.parse.com/1",CRUD_METHODS:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},apiOPTS:function(){return{contentType:C,processData:z,dataType:"json",data:u,headers:{"Content-Type":C,"X-Parse-Application-Id":Q.APP_ID,"X-Parse-REST-API-Key":Q.REST_KEY,"X-Parse-Session-Token":Q[S]}}},getConstructorName:function(e){var t;return e[o].name||((t=e[o].toString().match(/function+\s{1,}([A-Z]{1}[a-zA-Z]*)/))!=u?t[1]:Q[c])},Inflection:new function(){return{__uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],__plural_rules:[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,F],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,F],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh|lens)$/gi,F],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]],apply_rules:function(e,t,n){var r,i=this;return n.indexOf(e.toLowerCase())===-1&&(r=_.find(t,function(t){return e.match(t[0])}))!=u?e[W](r[0],r[1]):e},pluralize:function(e){return this.apply_rules(e,this.__plural_rules,this.__uncountable_words)}}}}),Q[q]=function(n){function a(e,n){a[r][o][x](this,e,n);if(typeof this[t]===h||this[t]===u)this[t]=Q[H](this);this[t]===Q[c]&&console.warn(s),this[t]=Q.Inflection.pluralize(this[t])}return __extends(a,n),a[e].idAttribute=i,a[e].url=function(){return""+Q[l]+E+this[t]+(this[A]()?"":"/"+this.get(i))},a[e][B]=function(t,n,r){var i;return r==u&&(r={}),i=Q[X](),i.data=JSON[T](this[P]()),Backbone[q][e][B][x](this,t,n,_[v](r,i))},a[e][P]=function(e){var t;return t=a[r][P][x](this,e),delete t.createdAt,delete t.updatedAt,t},a[e].__ops=[],a[e].increment=function(e,t){},a}(Backbone[q]),Q[q].saveAll=function(e,t){var r=this;return(new Q.Batch(e)).exec({complete:function(e,r,i){if(t[n])return t[n](e,r,i)},error:function(e,n,r){if(t[U])return t[U](e,n,r)}})},Q[a]=function(i){function f(e,n){f[r][o][x](this,e,n);if(typeof this[t]===h||this[t]===u)this[t]=Q[H](this);this[t]===Q[c]&&console.warn(s),this[t]=Q.Inflection.pluralize(this[t])}return __extends(f,i),f[e].__count=void 0,f[e].count=function(){return this.__count||this[b][L]},f[e][M]={limit:Q[g],count:1},f[e].getParams=function(){var e=this;return _.map(_.pairs(this[M]||u),function(e,t){return e.join("=")}).join("&")},f[e].url=function(){var e;return encodeURI(""+Q[l]+E+this[t]+(this[O]==="read"&&(e=this.getParams())[L]?"?"+e:""))},f[e].parse=function(e){var t;return t=f[r].parse[x](this,e),t.results||t},f[e][B]=function(t,r,i){var s,o=this;return this[O]=t,i==u&&(i={}),s=Q[X](),this[O]==="read"&&_.each(["order","count","limit","where"],function(e,t){if(i[e])return o[M][e]=JSON[T](i[e]),delete i[e]}),s[n]=function(e,t,r){o[M]={limit:Q[g],count:1};if(i[n]!=u)return i[n](e,t,r)},Backbone[a][e][B][x](this,this[O],r,_[v](_[R](i),s))},f[e].query=function(e,t){return t==u&&(t={}),this.fetch(_[v](t,{where:e}))},f[e].save=function(e){var t=this;return _.each(this[b],function(t,n){if(t[A]()||t.hasChanged())return t.fetch(e)})},f}(Backbone[a]),Q.User=function(t){function s(){return G=s[r][o].apply(this,arguments),G}return __extends(s,t),s[e].defaults={username:u,password:u,email:u},s[e][f]=m,s[e][k]={create:""+Q[l]+D,login:""+Q[l]+"/login",passwordReset:""+Q[l]+"/requestPasswordReset",operate:""+Q[l]+D},s[e].url=function(){return this[k][this[f]]+(this[f]===m&&!this[A]()?"/"+this.get(i):"")},s[e].logout=function(){return Q[S]=void 0,this[k][w]=this[k][w][W](/\/login+.*/,"/login")},s[e][w]=function(e,t,r){var i,s=this;return this[f]=w,this[k][w]=encodeURI(this[k][w][W](/\/login+.*/,"/login?username="+e+"&password="+t)),i={},i[n]=function(e,t,i){Q[S]=s.get(V),delete s.attributes[V];if(r[n])return r[n](e,t,i)},this.fetch(_[v](_[R](r),i))},s[e].save=function(e,t){return this[f]=this[A]()?I:m,s[r].save[x](this,e,t)},s[e][p]=function(e){var t,i=this;return this[f]=m,t={},t[n]=function(t,r,s){i.logout();if(e[n])return e[n](t,r,s)},s[r][p][x](this,_[v](_[R](e),t))},s[e].resetPassword=function(e){var t;return(t=this.get("email"))===u?z:(this[f]="passwordReset",s[r].save[x](this,{email:t},e))},s}(Q[q]),Q.Users=function(t){function n(){return Y=n[r][o].apply(this,arguments),Y}return __extends(n,t),n[e].url=function(){return""+Q[l]+D},n}(Q[a]),Q.Batch=function(s){function f(e,t){f[r][o][x](this,e,t)}return __extends(f,s),f[e].url=function(){return""+Q[l]+"/batch"},f[e][d]=[],f[e].processed=function(e){return e==u&&(e=!0),e?_.flatten(this[d]):this[d]},f[e][P]=function(e){return JSON[T]({requests:f[r][P][x](this,e)})},f[e][y]=function(e){return e[$](A)&&e[A]()||typeof e.get(i)===h||e.get(i===u||e.get(i===""))},f[e][J]=function(n,r){var s;return r==u&&(r={}),r[$](p)||(r=_[v](r,{destroy:z})),r[p]&&this[y](n)?s=u:(s={method:Q.CRUD_METHODS[r[p]?p:this[y](n)?I:"update"],path:"/"+Q.API_VERSION+E+n[t]+(this[y](n)?"":"/"+n.get(i))},r[p]||(s.body=n)),Backbone[a][e][J][x](this,s,r)},f[e][B]=function(e,t,r){var i,s=this;if(!t[b]||t[b][L]===0)return;return i=Q[X](),i.data=JSON[T]({requests:this[j]=t.slice(0,Q[N]>=0&&Q[N]<t[b][L]?Q[N]:t[b][L])}),i[n]=function(i,o,u){s[d].push(_.map(i,function(e,t,r){return _.chain(s[j][t].get("body")).tap(function(t){return typeof t!==h?t.set(e[n]):t=e[n]}).value()})),s.remove(s[j],{index:0,silent:!0}),setTimeout(function(){if(t[b][L]>0)return s[B](e,s,r);if(r[K])return r[K](s[d],o,u)},200);if(r[n])return r[n](i,o,u)},i[U]=function(e,t,n){if(r[U])return r[U](e,t,n)},i[K]=function(e,t,n){if(r.completed)return r.completed(e,t,n)},Backbone[B](e,t,_[v](_[R](r),i))},f[e].fetch=function(e){return console.warn("fetch is not supported by sparse.Batch try using sparse.Collection instead")},f[e].exec=function(e){return this[B](I,this,e)},f[e][p]=function(e,t){return this.add(e,_[v](_[R](t||{}),{destroy:!0}))},f[e].save=function(e,t){return this.add(e,t)},f}(Q[a])}.call(this);