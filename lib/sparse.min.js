// Generated by CoffeeScript 1.6.2
var Backbone,global,_,__hasProp={}.hasOwnProperty,__extends=function(e,t){function i(){this.constructor=e}var n="prototype";for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);return i[n]=t[n],e[n]=new i,e.__super__=t[n],e};global=typeof exports!="undefined"&&exports!==null?exports:window,typeof exports!="undefined"&&(_=require("underscore")._,Backbone=require("backbone")),function(){"use strict";var e="prototype",t="className",n="__super__",r="success",i="gi",s="objectId",o="sparse.Collection requires className to be defined",u="constructor",a=null,f="Collection",l="__action",c="API_URI",h="UNDEFINED_CLASSNAME",p="undefined",d="destroy",v="__processed",m="extend",g="operate",y="DEFAULT_FETCH_LIMIT_OVERRIDE",b="_memberIsNew",w="length",E="models",S="/classes/",x="login",T="call",N="SESSION_TOKEN",C="stringify",k="MAX_BATCH_SIZE",L="application/json",A="urlMap",O="__params",M="__method",D="isNew",P="getConstructorName",H="toJSON",B="sync",j="__to_remove",F="create",I="$1es",q="/users",R="clone",U=!1,z="sessionToken",W="apiOPTS",X="hasOwnProperty",V="_prepareModel",$="complete",J,K,Q;return global.sparse||(J=global.sparse={VERSION:"0.0.1",APP_ID:void 0,REST_KEY:void 0,SESSION_TOKEN:void 0,API_VERSION:"1",MAX_BATCH_SIZE:50,DEFAULT_FETCH_LIMIT_OVERRIDE:2e5,UNDEFINED_CLASSNAME:"__UNDEFINED_CLASSNAME__",API_URI:"https://api.parse.com/1",CRUD_METHODS:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},apiOPTS:function(){return{contentType:L,processData:U,dataType:"json",data:a,headers:{"Content-Type":L,"X-Parse-Application-Id":J.APP_ID,"X-Parse-REST-API-Key":J.REST_KEY,"X-Parse-Session-Token":J[N]}}},getConstructorName:function(e){var t;return e[u].name||((t=e[u].toString().match(/function+\s{1,}([A-Z]{1}[a-zA-Z]*)/))!=a?t[1]:J[h])},Inflection:new function(){return{__uncountable_words:["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],__plural_rules:[[new RegExp("(m)an$",i),"$1en"],[new RegExp("(pe)rson$",i),"$1ople"],[new RegExp("(child)$",i),"$1ren"],[new RegExp("^(ox)$",i),"$1en"],[new RegExp("(ax|test)is$",i),I],[new RegExp("(octop|vir)us$",i),"$1i"],[new RegExp("(alias|status)$",i),I],[new RegExp("(bu)s$",i),"$1ses"],[new RegExp("(buffal|tomat|potat)o$",i),"$1oes"],[new RegExp("([ti])um$",i),"$1a"],[new RegExp("sis$",i),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$",i),"$1$2ves"],[new RegExp("(hive)$",i),"$1s"],[new RegExp("([^aeiouy]|qu)y$",i),"$1ies"],[new RegExp("(x|ch|ss|sh|lens)$",i),I],[new RegExp("(matr|vert|ind)ix|ex$",i),"$1ices"],[new RegExp("([m|l])ouse$",i),"$1ice"],[new RegExp("(quiz)$",i),"$1zes"],[new RegExp("s$",i),"s"],[new RegExp("$",i),"s"]],apply_rules:function(e,t,n){var r,i,s;if(n.indexOf(e.toLowerCase())===-1)for(r=i=0,s=t[w];0<=s?i<=s:i>=s;r=0<=s?++i:--i)if(e.match(t[r][0]))return e.replace(t[r][0],t[r][1]);return e},pluralize:function(e){return this.apply_rules(e,this.__plural_rules,this.__uncountable_words)}}}}),J.Model=function(r){function i(e,r){i[n][u][T](this,e,r);if(typeof this[t]===p||this[t]===a)this[t]=J[P](this);this[t]===J[h]&&console.warn(o),this[t]=J.Inflection.pluralize(this[t])}return __extends(i,r),i[e].idAttribute=s,i[e].url=function(){return""+J[c]+S+this[t]+(this[D]()?"":"/"+this.get(s))},i[e][B]=function(t,n,r){var i;return r==a&&(r={}),i=J[W](),i.data=JSON[C](this[H]()),Backbone.Model[e][B][T](this,t,n,_[m](r,i))},i[e][H]=function(e){var t;return t=i[n][H][T](this,e),delete t.createdAt,delete t.updatedAt,t},i}(Backbone.Model),J[f]=function(i){function s(e,r){s[n][u][T](this,e,r);if(typeof this[t]===p||this[t]===a)this[t]=J[P](this);this[t]===J[h]&&console.warn(o),this[t]=J.Inflection.pluralize(this[t])}return __extends(s,i),s[e].__count=void 0,s[e].count=function(){return this.__count||this[E][w]},s[e][O]={limit:J[y],count:1},s[e].getParams=function(){var e=this;return _.map(_.pairs(this[O]||a),function(e,t){return e.join("=")}).join("&")},s[e].url=function(){var e;return encodeURI(""+J[c]+S+this[t]+(this[M]==="read"&&(e=this.getParams())[w]?"?"+e:""))},s[e].parse=function(e){var t;return t=s[n].parse[T](this,e),t.results||t},s[e][B]=function(t,n,i){var s,o=this;return this[M]=t,i==a&&(i={}),s=J[W](),this[M]==="read"&&_.each(["order","count","limit","where"],function(e,t){if(i[e])return o[O][e]=JSON[C](i[e]),delete i[e]}),s[r]=function(e,t,n){o[O]={limit:J[y],count:1};if(i[r]!=a)return i[r](e,t,n)},Backbone[f][e][B][T](this,this[M],n,_[m](_[R](i),s))},s[e].query=function(e,t){return t==a&&(t={}),this.fetch(_[m](t,{where:e}))},s[e].save=function(e){var t=this;return _.each(this[E],function(t,n){if(t[D]()||t.hasChanged())return t.fetch(e)})},s}(Backbone[f]),J.User=function(t){function i(){return K=i[n][u].apply(this,arguments),K}return __extends(i,t),i[e].defaults={username:a,password:a,email:a},i[e][l]=g,i[e][A]={create:""+J[c]+q,login:""+J[c]+"/login",passwordReset:""+J[c]+"/requestPasswordReset",operate:""+J[c]+q},i[e].url=function(){return this[A][this[l]]+(this[l]===g&&!this[D]()?"/"+this.get(s):"")},i[e].logout=function(){return J[N]=void 0,this[A][x]=this[A][x].replace(/\/login+.*/,"/login")},i[e][x]=function(e,t,n){var i,s=this;return this[l]=x,this[A][x]=encodeURI(this[A][x].replace(/\/login+.*/,"/login?username="+e+"&password="+t)),i={},i[r]=function(e,t,i){J[N]=s.get(z),delete s.attributes[z];if(n[r])return n[r](e,t,i)},this.fetch(_[m](_[R](n),i))},i[e].save=function(e,t){return this[l]=this[D]()?F:g,i[n].save[T](this,e,t)},i[e][d]=function(e){var t,s=this;return this[l]=g,t={},t[r]=function(t,n,i){s.logout();if(e[r])return e[r](t,n,i)},i[n][d][T](this,_[m](_[R](e),t))},i[e].resetPassword=function(e){var t;return(t=this.get("email"))===a?U:(this[l]="passwordReset",i[n].save[T](this,{email:t},e))},i}(J.Model),J.Users=function(t){function r(){return Q=r[n][u].apply(this,arguments),Q}return __extends(r,t),r[e].url=function(){return""+J[c]+q},r}(J[f]),J.Batch=function(i){function o(e,t){o[n][u][T](this,e,t)}return __extends(o,i),o[e].url=function(){return""+J[c]+"/batch"},o[e][v]=[],o[e].processed=function(e){return e==a&&(e=!0),e?_.flatten(this[v]):this[v]},o[e][H]=function(e){return JSON[C]({requests:o[n][H][T](this,e)})},o[e][b]=function(e){return e[X](D)&&e[D]()||typeof e.get(s)===p||e.get(s===a||e.get(s===""))},o[e][V]=function(n,r){var i;return r==a&&(r={}),r[X](d)||(r=_[m](r,{destroy:U})),r[d]&&this[b](n)?i=a:(i={method:J.CRUD_METHODS[r[d]?d:this[b](n)?F:"update"],path:"/"+J.API_VERSION+S+n[t]+(this[b](n)?"":"/"+n.get(s))},r[d]||(i.body=n)),Backbone[f][e][V][T](this,i,r)},o[e][B]=function(e,t,n){var i,s=this;if(!t[E]||t[E][w]===0)return;return i=J[W](),i.data=JSON[C]({requests:this[j]=t.slice(0,J[k]>=0&&J[k]<t[E][w]?J[k]:t[E][w])}),i[r]=function(i,o,u){s[v].push(_.map(i,function(e,t,n){return _.chain(s[j][t].get("body")).tap(function(t){return typeof t!==p?t.set(e[r]):t=e[r]}).value()})),s.remove(s[j],{index:0,silent:!0}),setTimeout(function(){if(t[E][w]>0)return s[B](e,s,n);if(n[$])return n[$](s[v],o,u)},200);if(n[r])return n[r](i,o,u)},i.error=function(e,t,r){if(n.error)return n.error(e,t,r)},i[$]=function(e,t,r){if(n.completed)return n.completed(e,t,r)},Backbone[B](e,t,_[m](_[R](n),i))},o[e].fetch=function(e){return console.warn("fetch is not supported by sparse.Batch try using sparse.Collection instead")},o[e].exec=function(e){return this[B](F,this,e)},o[e][d]=function(e,t){return this.add(e,_[m](_[R](t||{}),{destroy:!0}))},o[e].save=function(e,t){return this.add(e,t)},o}(J[f])}.call(this);